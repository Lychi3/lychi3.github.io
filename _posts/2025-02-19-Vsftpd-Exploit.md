---
title: Explotando el Backdoor de vsftpd 2.3.4
date: 2025-02-19 19:51:00 -0600
categories: [dockerlabs]
tags: [exploit]
---

Hace un rato estaba realizando el laboratirio FirstHacking de nivel very easy en la plataforma [dockerlabs](https://dockerlabs.es)
en la que hay que explotar una vulnerabilidad del servicio FTP que tiene la version `vsftpd 2.3.4` la cual tiene una vulnerabilidad que
nos permite obtener una shell como el usuario root

La manera mas facil de lograr esto es usar un modulo de Metasploit, sin embargo a mi no me gusta mucho el uso de esta herramienta,
no estoy en contra de su uso ya que es muy util y poderosa, obviamente la he utilizado y hay algunos exploits que solo he encontrado en
Metasploit, sin embargo, no hay que depender totalmente de esta herramienta y hay que investigar acerca de las vulnerabilidades para poder
aprender de una mejor manera

## Descripcion

Investigando sobre esta vulnerabilidad pude ver que en realidad se trata de un Backdoor que alguien agrego al codigo fuente de manera
maliciosa  
Para acceder a este Backdoor debemos enviar cualquier usuario, pero al final debe contener los caracteres `:)` (si, asi es, una carita feliz)
y cualquier contraseña, una vez que se haya realizado esto, se abrira una shell en la maquina vulnerable

## Explotacion manual

Lo primero que haremos para acceder a este Backdoor es conectarnos al servicio, pero no lo haremos por ftp ya que la conexión se cierra
al escribir la contraseña, nos conectaremos mediante telnet

`telnet 172.17.0.2 21`

Una vez conectados, tenemos que especificar el usuario y la contraseña, el usuario puede ser el que sea, pero debe terminar con una carita feliz
`:)` y la contraseña puede ser cualquiera

`USER usuario:)`  
`PASS password`

![Telnet](/../assets/images/vsftpd-Exploit/telnet.png)

Una vez hayamos enviado estos datos, el servidor abrira su puerto `6200` que en realidad es una shell a la que nos podemos conectar, para esto
podemos utilizar `netcat` en otra terminal

![Netcat](/../assets/images/vsftpd-Exploit/netcat.png)

Parece que no paso nada, sin embargo no dice que la conexión fue rechazada ni nos da ningun error, asi que probemos enviando algunos comandos

![Comandos](/../assets/images/vsftpd-Exploit/comandos.png)

Por lo que podemos ver, la conexión si funciono y tenemos una shell como el usuario root

## Exploit

Debido a que es bastante facil de replicar, hice un exploit en python para poder acceder al Backdoor de manera automatica. El exploit esta hecho
con la libreria `pwntools`, la cual es mayormente usada para explotacion de binarios, pero nada me impide utilizarla para esto, ademas de que
es bastante simple de usar y tiene funciones que me ayudan mucho en la automatizacion

El exploit esta disponible en [mi perfil de github](https://github.com/lychi3) y lo pueden clonar con el comando  
`git clone https://github.com/Lychi3/vsftpd-backdoor.git`

![Exploit](/../assets/images/vsftpd-Exploit/exploit.png)

## Referencias
[https://nvd.nist.gov/vuln/detail/CVE-2011-2523](https://nvd.nist.gov/vuln/detail/CVE-2011-2523)  
[https://www.h1rd.com/hacking/Metasploitable2-vsftpd-manual](https://www.h1rd.com/hacking/Metasploitable2-vsftpd-manual)
